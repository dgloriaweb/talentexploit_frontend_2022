<template>
  Here we are
  {{ users }}
  <ul>
    <li v-for="user in users" :key="user.id">
      {{ user.user_name }}
      <user v-bind:user="user" />
    </li>
  </ul>
</template>

<script>
import User from "./User.vue"
import axios from "axios"

export default {
  name: "UserList",
  data() {
    return {
      users: [],
      access_token: null
    }
  },
  created() {
    this.getuserdata()
  },
  methods: {

    /* get token */
    // getToken: async function () {
    //   try {
    //     const headers = {
    //       'grant_type': 'client_credentials',
    //       "client_id": "3",
    //       "client_secret": "6TKH3Tqu0PL7K7zBPkIMTaatjJOz5T1AMnNu83Wa",
    //       'email': 'dgloria.work@gmail.com',
    //       'password': 'myBestproject4ever$',
    //     }
    //     const response = await axios.post('https://talentexploit.com/oauth/token', headers)
    //     this.access_token = response.data.access_token
    //     console.log(this.access_token)
    //     /*   save received token to local and setup a timer to renew token */
    //     localStorage.setItem('token', this.access_token)

    //     /* start session or resume session */
    //   }
    //   catch (error) {
    //     console.log(error)
    //   }
    // },

    /* user is not logged in no token present */
    getToken: async function () {

      try {

        const url = 'https://talentexploit.com/oauth/token'
        const headers = {
          "grant_type": 'client_credentials',
          "client_id": "8",
          "client_secret": "mcx428F1HgcX8K4k1HXSxqP2a5gn0L92BegNpWHx",
        }

        const response = await axios.post(url, headers)
        console.log(response)
        this.access_token = response.data.access_token
        console.log(response.data)
        /*   save received token to local and setup a timer to renew token */
        localStorage.setItem('token', this.access_token)
      }
      catch (error) {
        // handle timeout
        console.log(error)
      }
    },

    /* token is stored, need to get the list of users  */
    getUsers: async function () {
      const config = {
        method: 'get',
        url: 'https://talentexploit.com/api/users',
        headers: {
          Authorization: `Bearer ` + this.access_token,
        }

      }
      console.log(config)
      try {
        const response = await axios(config)
        console.log(response)
      }
      catch (error) {
        // handle timeout
        console.log(error)
      }
    },

    getuserdata() {
      /* check if local has token */
      this.access_token = localStorage.getItem('token')
      if (!this.access_token) {
        /*send init to server */

        this.getToken()

      } else {

        /* send init to server with token */

        /* get response */
        this.getUsers()

      }
    }

  },
  components: {
    User
  },
};
</script>

<style lang="scss" scoped>
</style>