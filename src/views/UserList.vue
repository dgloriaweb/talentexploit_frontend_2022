<template>
  Here we are
  {{ users }}
  <ul>
    <li v-for="user in users" :key="user.id">
      {{ user.user_name }}
      <user v-bind:user="user" />
    </li>
  </ul>
</template>

<script>
import User from "./User.vue"
import axios from "axios"

export default {
  name: "UserList",
  data() {
    return {
      users: [],
      access_token: null
    }
  },
  created() {
    this.getuserdata()
  },
  methods: {
    getUsers: async function () {
      try {
        const headers = {
          "email": "dgloria.work@gmail.com",
          "password": "myBestproject4ever$",
          "password_confirmation": "myBestproject4ever$",
          "access_token": this.access_token,
        }
        const response = await axios.get('https://talentexploit.com/api/users', headers)
        this.users = response.data
        console.log(this.users)
      }
      catch (error) {
        console.log(error)
      }
    },

    /* get token */
    getToken: async function () {
      try {
        const headers = {
          'grant_type': 'client_credentials',
          "client_id": "3",
          "client_secret": "6TKH3Tqu0PL7K7zBPkIMTaatjJOz5T1AMnNu83Wa",
          'email': 'dgloria.work@gmail.com',
          'password': 'myBestproject4ever$',
        }
        const response = await axios.post('https://talentexploit.com/oauth/token', headers)
        this.access_token = response.data.access_token
        console.log(this.access_token)
        /*   save received token to local and setup a timer to renew token
        start session or resume session */
      }
      catch (error) {
        console.log(error)
      }
    },

    getuserdata() {
      /* check if local has token */
      if (!this.access_token) {
        /*send init to server */

        this.getToken()        

      } else {
        /* send init to server with token */

      /* get response */
        this.getUsers()

     }
    }

  },
  components: {
    User
  },
};
</script>

<style lang="scss" scoped>
</style>