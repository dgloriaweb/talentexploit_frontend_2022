<template>
  Here we are
  {{ users }}
  <ul>
    <li v-for="user in users" :key="user.id">
      {{ user.user_name }}
      <user v-bind:user="user" />
    </li>
  </ul>
</template>

<script>
import User from "./User.vue"
import axios from "axios"

export default {
  name: "UserList",
  data() {
    return {
      users: [],
      access_token: null
    }
  },
  created() {
    this.getuserdata()
  },
  methods: {

    /* get token */
    getToken: async function () {
      try {
        const headers = {
          'grant_type': 'client_credentials',
          "client_id": "3",
          "client_secret": "6TKH3Tqu0PL7K7zBPkIMTaatjJOz5T1AMnNu83Wa",
          'email': 'dgloria.work@gmail.com',
          'password': 'myBestproject4ever$',
        }
        const response = await axios.post('https://talentexploit.com/oauth/token', headers)
        this.access_token = response.data.access_token
        console.log(this.access_token)
        /*   save received token to local and setup a timer to renew token */
        localStorage.setItem('token', this.access_token)

        /* start session or resume session */
      }
      catch (error) {
        console.log(error)
      }
    },
    getUsers: async function () {
      axios.defaults.baseURL = 'https://talentexploit.com/api'
      axios.defaults.headers.common = { 'Authorization': `bearer ${this.access_token}` }

      try {
        let headersList = {
          "Accept": "*/*",
            "Content-type": "application/json",
            "client_id": "7",
            "client_secret": "LH20Z1YJiPMg9V8hbMaX7MqhBlKlgWLCKauQGCvH",
                       
            // "token_url":"https://talentexploit.com/oauth/token",
            // "callback_url":"https://www.thunderclient.io/oauth/callback",
            // "scope":"https://talentexploit.com"
        }
        let reqOptions = {
          url: "https://talentexploit.com/api/users",
          method: "GET",
          headers: headersList,
        }

        axios.request(reqOptions).then(function (response) {
          console.log(response.data)
        })
      }
      catch (error) {
        // handle timeout
        console.log(error)
      }
    },

    getuserdata() {
      /* check if local has token */
      this.access_token = localStorage.getItem('token')
      if (!this.access_token) {
        /*send init to server */

        this.getToken()

      } else {

        /* send init to server with token */

        /* get response */
        this.getUsers()

      }
    }

  },
  components: {
    User
  },
};
</script>

<style lang="scss" scoped>
</style>